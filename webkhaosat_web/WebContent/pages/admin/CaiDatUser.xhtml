<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:c="http://java.sun.com/jsp/jstl/core">


<h:body>
	<ui:composition template="common.xhtml">
		<ui:define name="content">
			<h:form id="loadResult">
				<!-- Them bo cau hoi -->
				<div class="row"
					style="width: 90%; box-shadow: 0px 0px 5px #000;; margin: 0 auto; border-radius: 5px; margin-top: 20px;margin-bottom: 5px;">
					<div class="row" style="margin: 0 auto">
						<p style="width: 100%">
							<span>DANH SÁCH NHÂN VIÊN: <h:inputText
									style="color: black;width: 100%;border-radius: 5px"
									value="#{settingUserBean.surveyPlaying.name}" disabled="true"></h:inputText></span>
						</p>
					</div>
					<div style="width: 50%; margin-left: 57%">
						<p:linkButton icon="fa fa-arrow-left" outcome="index"
							value="Quay lại"
							style="background-color: #46af79;border-color:#46af79; margin-right: 10px">
						</p:linkButton>
						<p:commandButton value="Lưu/Cập nhật" icon="fa fa-save"
							update="loadResult:dtEmployees"
							style=" margin-left: 1%;margin-bottom: 10px;color: #fff;background-color: #d79d39;border-color:#d79d39"
							action="#{settingUserBean.saveOrUpdate}" />
						<p:commandButton value="Thêm nhân viên" icon="fa fa-plus"
							style=" margin-left: 1%;margin-bottom: 10px;color: #fff;background-color: #007bff;border-color:#007bff"
							update="loadResult:addEmployee"
							oncomplete="PF('dialogAddEmployee').show();" />
						<p:commandButton value="Xóa" icon="fa fa-trash-o"
							update="loadResult:dtEmployees"
							style=" margin-left: 1%;margin-bottom: 10px;color: #fff;background-color: #dc3545;border-color:#dc3545"
							action="#{settingUserBean.deleteEmployees}" />
					</div>
					<!-- TEST -->
					<div style="width: 60%;margin-left: 46%" class="row">
						<div style="width: 20%;text-align:right">
							<span>Tìm kiếm: <i class="fa fa-search-plus"/></span>
						</div>
						<div style="width: 80%">
							<p:autoComplete id="themePojo"
								value="#{settingUserBean.autocompleteEmployee}"
								completeMethod="#{settingUserBean.completeTest}" var="theme"
								itemLabel="#{theme.name}" itemValue="#{theme}"
								converter="#{themeConverter}" minQueryLength="4"
								forceSelection="true" scrollHeight="400" size="56"
								style="font-size:80px"
								>
								<p:column style="width:20%" headerText="Mã">
									<h:outputText value="#{theme.code}" />
								</p:column>
								<p:column style="width:50%" headerText="Tên">
									<h:outputText value="#{theme.name}" />
								</p:column>

								<p:column style="width:30%" headerText="Phòng ban">
									<h:outputText value="#{theme.department.name}" />
								</p:column>
								<p:ajax event="itemSelect"
									listener="#{settingUserBean.autocompleteSelected()}"
									update="loadResult:dtEmployees themePojo" />
							</p:autoComplete>
						</div>
					</div>
					<p:dataTable id="dtEmployees" var="employee"
						value="#{settingUserBean.employeesBySurList}"
						sortBy="#{employee.department.name}"
						style="width:70%;margin:0 auto" expandableRowGroups="true"
						selection="#{settingUserBean.selectedDelete}"
						rowKey="#{employee.id}" paginator="true" rows="30"
						 rowsPerPageTemplate="30,50,100">
						<p:headerRow>
							<p:column colspan="3">
								<h:outputText value="#{employee.department.name}" />
							</p:column>
						</p:headerRow>
						<p:column selectionMode="multiple"
							style="width:100px;text-align:center" />
						<p:column headerText="Mã" style="width: 100px; text-align: center">
							<h:outputText value="#{employee.code}" />
						</p:column>
						<p:column style="text-align: left" headerText="Tên nhân viên">
							<h:outputText value="#{employee.name}" />
						</p:column>
					</p:dataTable>
					<!-- DIALOG Them User  -->
					<p:dialog header="Thêm" id="addEmployee" width="600"
						widgetVar="dialogAddEmployee" modal="true" showEffect="fade"
						hideEffect="fade" resizable="true">
						<p:outputPanel id="editSetof" style="text-align:center;">
							<div style="width: 50%; margin-left: 42%">
								<p:linkButton outcome="CaiDatUser" icon="fa fa-arrow-left"
									value="Quay lại"
									style="background-color: #46af79;border-color:#46af79; margin-right: 10px">
									<c:if test="${settingUserBean.surveyId != 0}">
										<f:param name="setofid" value="#{settingUserBean.surveyId}" />
									</c:if>
								</p:linkButton>
								<p:commandButton id="btnAddUser" value="Thêm" icon="fa fa-plus"
									style=" margin-left: 1%;margin-bottom: 5px;color: #fff;background-color: #007bff;border-color:#007bff"
									update="loadResult:dtEmployees addEmployee"
									action="#{settingUserBean.addEmployee()}" onclick="start()"
									widgetVar="startButton1" />
								<br />
							</div>
							<p:progressBar id="progressBarClient" widgetVar="pbClient"
								style="width:190px;margin-left:50%" />
							<br />

							<p:dataTable id="dtAddEmployees" var="department"
								value="#{settingUserBean.departmentsByLocate}"
								sortBy="#{department.locateName}" expandableRowGroups="true"
								style="width:70%;margin:0 auto"
								selection="#{settingUserBean.departmentsSelected}"
								rowKey="#{department.id}">
								<p:headerRow>
									<p:column colspan="3">
										<h:outputText value="#{department.locateName}" />
									</p:column>
								</p:headerRow>
								<p:column selectionMode="multiple"
									style="width:70px;text-align:center" />
								<p:column headerText="Mã"
									style="width: 100px; text-align: center">
									<h:outputText value="#{department.departmentCode}" />
								</p:column>
								<p:column style="width:100%;text-align: left"
									headerText="Tên phòng ban">
									<h:outputText value="#{department.departmentName}" />
								</p:column>
							</p:dataTable>
						</p:outputPanel>
					</p:dialog>
					<!-- Ket Thuc -->
				</div>
			</h:form>
			<script type="text/javascript">
				    //<![CDATA[
				function start() {
				    PF('startButton1').disable();
				     
				    window['progress'] = setInterval(function() {
				var pbClient = PF('pbClient'),
				oldValue = pbClient.getValue(),
				newValue = oldValue + 10;
				         
				pbClient.setValue(pbClient.getValue() + 10);
				     
				if(newValue === 100) {
				    clearInterval(window['progress']);
				}
				 
				 
				    }, 1000);
				}
				 
				function cancel() {
				    clearInterval(window['progress']);
				    PF('pbClient').setValue(0);
				    PF('startButton1').enable();
				}
				    //]]>
			</script>
		</ui:define>
	</ui:composition>
</h:body>

</html>